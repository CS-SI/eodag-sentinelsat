---
!provider
name: scihub
priority: 0
api: !plugin
  type: SentinelsatAPI
  endpoint: 'https://scihub.copernicus.eu/apihub/'
  dont_quote:
    - '['
    - ']'
    - '$'
    - '='
    - '&'
    - ':'
  pagination:
    next_page_query_obj: '{{"limit":{items_per_page},"offset":{skip}}}'
    next_page_url_tpl: '{url}/odata/v1/Products?{search}&$top={items_per_page}&$skip={skip}'
    total_items_nb_key_path: 'https://scihub.copernicus.eu/apihub/odata/v1/Products/$count'
  results_entry: 'value'
  discover_metadata:
    auto_discovery: true
    metadata_pattern: '^[a-zA-Z0-9]+$'
    search_param:
      free_text_search_operations:
        $search:
          operations:
            AND:
              - '({metadata}:{{{metadata}}})'
    metadata_path: '$.*'
  metadata_mapping:
    id: '$.uuid'
    uuid: '$.uuid'
    geometry:
      - area
      - '$.footprint'
    productType:
      - producttype
      - '$.producttype'
    platform:
      - platformname
      - '$.platformname'
    platformSerialIdentifier: '$.platformserialidentifier'
    instrument: '$.instrumentname'
    processingLevel: '$.processinglevel'
    title: '$.title'
    keyword: '$.keywords'
    abstract: '$.summary'
    orbitNumber: '$.orbitnumber'
    orbitDirection: '$.orbitdirection'
    cloudCover:
      - cloudcoverpercentage
      - '$.cloudcoverpercentage'
    startTimeFromAscendingNode:
      - start
      - '$.beginposition'
    completionTimeFromAscendingNode:
      - end
      - '$.endposition'
    downloadLink: '$.link'

    # Additional metadata provided by the providers but that don't appear in the reference spec
    linkAlternative: '$.link_alternative'
    ingestionDate: '$.ingestiondate'
    relativeOrbitNumber: '$.relativeorbitnumber'
    gmlFootprint: '$.gmlfootprint'
    format: '$.format'
    processingBaseline: '$.processingbaseline'
    filename:
      - filename
      - '$.filename'
    instrumentShortname: '$.instrumentshortname'
    size: '$.size'
    s2DatatakeId: '$.s2datatakeid'
    platformIdentifier: '$.platformidentifier'
    identifier: '$.identifier'
    raw:
      - raw
      - '$.raw'
    # storageStatus: must be one of ONLINE, STAGING, OFFLINE
    storageStatus: '{$.storage_status#get_group_name((?P<ONLINE>True)|(?P<OFFLINE>False))}'
products:
  S1_SAR_OCN:
    productType: OCN
    platform: Sentinel-1
  S1_SAR_GRD:
    productType: GRD
    platform: Sentinel-1
  S1_SAR_SLC:
    productType: SLC
    platform: Sentinel-1
  S2_MSI_L1C:
    productType: S2MSI1C
    platform: Sentinel-2
  S2_MSI_L2A:
    productType: S2MSI2A
    platform: Sentinel-2
  S3_EFR:
    productType: OL_1_EFR___
    platform: Sentinel-3
  S3_ERR:
    productType: OL_1_ERR___
    platform: Sentinel-3
  S3_OLCI_L2LFR:
    productType: OL_2_LFR___
    platform: Sentinel-3
  S3_OLCI_L2LRR:
    productType: OL_2_LRR___
    platform: Sentinel-3
  S3_SLSTR_L1RBT:
    productType: SL_1_RBT___
    platform: Sentinel-3
  S3_SLSTR_L2LST:
    productType: SL_2_LST___
    platform: Sentinel-3
  S3_LAN:
    productType: SR_2_LAN___
    platform: Sentinel-3
